{% extends 'base.html' %} {% load static %}

{% block extrahead %}

<link rel="stylesheet" href="{% static 'css/detail.css' %}">

{% endblock %}
{% block content %}
<div class="write">
  <div class="container">
    <div class="image">
      {% if my_write.images %}
      <img src="{{my_write.images.url}}">
      {% endif %}
    </div>

    <div class="contents">
      <div class="content">
        <div id="title">{{my_write.title}}</div>
        <div id="date">{{my_write.updated_at}}</div>
        <div id="button"><a href="{%url 'main:update' my_write.id %}"><button>| ìˆ˜ì •</button></a>
          <a href="{%url 'main:delete' my_write.id %}"><button>| ì‚­ì œ</button></a>
          <a href="{%url 'main:page' my_write.id %}"><button>| ì§€ë„ì¶”ê°€</button></a><br>
        </div>

        <hr noshade="" color="black" size="1.5">
        <div id="content">{{my_write.contents}}</div>

      </div>
    </div>
  </div>

  <div id="place">
    <p>TRAVEL ROUTE</p>
    {% for map in map.all %}
    <tr>
      <td>{{ map.placename }}</td> >

    </tr>
    {% endfor %}
  </div>
  <div id="map" style="width:100%;height:400px;"></div>
  <script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e4629dfd6293cb3c36858f5010d2a71e&libraries=services"></script>
    <script>
  
 
      // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì„ í‘œì¶œí•  ì¸í¬ìœˆë„ìš° ì…ë‹ˆë‹¤
      var infowindow = new kakao.maps.InfoWindow({zIndex:1});
       
      var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
          mapOption = {
              center: new kakao.maps.LatLng(37.539448, 126.987477), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
              level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
          };  
          var map = new kakao.maps.Map(mapContainer, mapOption); 
          var infowindow = new kakao.maps.InfoWindow({zIndex:1});
          var imageSrc = "https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/markerStar.png"; 
          var bounds = new kakao.maps.LatLngBounds();
      
          var positions =[
              {% for i in map %}
              {
                  lat : {{i.lat}},
                  lon : {{i.lon}},
                  title : '{{i.placename}}',
                  latlng : new kakao.maps.LatLng({{i.lat}},{{i.lon}})
                },
              {% endfor %}
          ]; 
               
      
          for (var i = 0; i < positions.length; i ++) {
              
              // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ í¬ê¸° ì…ë‹ˆë‹¤
              var imageSize = new kakao.maps.Size(24, 35); 
              
              // ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤    
              var markerImage = new kakao.maps.MarkerImage(imageSrc, imageSize); 
              
              // ë§ˆì»¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
              var marker = new kakao.maps.Marker({
                  map: map, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ì§€ë„
                  position: positions[i].latlng, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìœ„ì¹˜
                  title : positions[i].title, // ë§ˆì»¤ì˜ íƒ€ì´í‹€, ë§ˆì»¤ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ íƒ€ì´í‹€ì´ í‘œì‹œë©ë‹ˆë‹¤
                  image : markerImage // ë§ˆì»¤ ì´ë¯¸ì§€ 
              });
              bounds.extend(positions[i].latlng);
        
          }  
            
              // LatLngBounds ê°ì²´ì— ì¶”ê°€ëœ ì¢Œí‘œë“¤ì„ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ì˜ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
              // ì´ë•Œ ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œì™€ ë ˆë²¨ì´ ë³€ê²½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤
              map.setBounds(bounds);
          
      
      
      </script>

  

  <div class="like">
    <p> {{my_write.like_count}}</p>
    <a href="{% url 'main:post_like_toggle' my_write.id %}">

      {% if my_write in profile.like_post.all %}
      ğŸ’œì·¨ì†Œ
      {% else %}
      ğŸ¤ì¢‹ì•„ìš”
      {% endif %}
    </a>

  </div>

  <div class="comments">
    {% for comment in comments %}
    <span id="username">{{comment.user}}</span>
    <span id="comment_time">| {{comment.updated_at}}</span>
    <div id="comment">{{comment.content}}</div>
    <div id="delete_button"><a href="{% url 'main:delete_comment' my_write.id comment.id%}">ì‚­ì œ</a></div><br>
    <hr>
    <br><br>
    {%endfor%}
  </div>
  <div class="create_comments">
    {% if user.is_authenticated %}
    <form method="POST" action="{% url 'main:create_comment' my_write.id %}">
      {% csrf_token %}
      {{comment_form}}
      <span id="create_button"><button type="submit"><img src="{%static 'images/plane.png'%}"></button></span>
    </form>
    {%endif%}
  </div>

  {% endblock %}