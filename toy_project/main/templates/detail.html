{% extends 'base.html' %} {% load static %}

{% block extrahead %}

<link rel="stylesheet" href="{% static 'css/detail.css' %}">

{% endblock %}
{% block content %}
<div class="write">
  <div class="container">
    <div class="image">
      {% if my_write.images %}
      <img src="{{my_write.images.url}}">
      {% endif %}
    </div>

    <div class="contents">
      <div class="content">
        <div id="title">{{my_write.title}}</div>
        <div id="date">{{my_write.updated_at}}</div>
        <div id="button"><a href="{%url 'main:update' my_write.id %}"><button>| ìˆ˜ì •</button></a>
          <a href="{%url 'main:delete' my_write.id %}"><button>| ì‚­ì œ</button></a>
          <a href="{%url 'main:page' my_write.id %}"><button>| ì§€ë„ì¶”ê°€</button></a><br>
        </div>

        <hr noshade="" color="black" size="1.5">
        <div id="content">{{my_write.contents}}</div>

      </div>
    </div>
  </div>

  <div id="place">
    <p>TRAVEL ROUTE</p>
    {% for map in map.all %}
    <tr>
      <td>{{ map.placename }}</td> >

    </tr>
    {% endfor %}
  </div>
  <div id="map" style="width:100%;height:400px;"></div>
  <script type="text/javascript"
    src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e4629dfd6293cb3c36858f5010d2a71e&libraries=services"></script>


  <script>
    // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì„ í‘œì¶œí•  ì¸í¬ìœˆë„ìš° ì…ë‹ˆë‹¤
    var infowindow = new kakao.maps.InfoWindow({ zIndex: 1 });

    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div 
      mapOption = {
        center: new kakao.maps.LatLng(37.566826, 126.9786567), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
        level: 3 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
      };

    // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤    
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // ì¥ì†Œ ê²€ìƒ‰ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
    var ps = new kakao.maps.services.Places();

    // í‚¤ì›Œë“œë¡œ ì¥ì†Œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤
    ps.keywordSearch('ì´íƒœì› ë§›ì§‘', placesSearchCB);

    // í‚¤ì›Œë“œ ê²€ìƒ‰ ì™„ë£Œ ì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜ ì…ë‹ˆë‹¤
    function placesSearchCB(data, status, pagination) {
      if (status === kakao.maps.services.Status.OK) {

        // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•˜ê¸°ìœ„í•´
        // LatLngBounds ê°ì²´ì— ì¢Œí‘œë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤
        var bounds = new kakao.maps.LatLngBounds();

        for (var i = 0; i < data.length; i++) {
          displayMarker(data[i]);
          bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
        }

        // ê²€ìƒ‰ëœ ì¥ì†Œ ìœ„ì¹˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì§€ë„ ë²”ìœ„ë¥¼ ì¬ì„¤ì •í•©ë‹ˆë‹¤
        map.setBounds(bounds);
      }
    }

    // ì§€ë„ì— ë§ˆì»¤ë¥¼ í‘œì‹œí•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤
    function displayMarker(place) {

      // ë§ˆì»¤ë¥¼ ìƒì„±í•˜ê³  ì§€ë„ì— í‘œì‹œí•©ë‹ˆë‹¤
      var marker = new kakao.maps.Marker({
        map: map,
        position: new kakao.maps.LatLng(place.y, place.x)
      });

      // ë§ˆì»¤ì— í´ë¦­ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•©ë‹ˆë‹¤
      kakao.maps.event.addListener(marker, 'click', function () {
        // ë§ˆì»¤ë¥¼ í´ë¦­í•˜ë©´ ì¥ì†Œëª…ì´ ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë©ë‹ˆë‹¤
        infowindow.setContent('<div style="padding:5px;font-size:12px;">' + place.place_name + '</div>');
        infowindow.open(map, marker);
      });
    }
  </script>

  <div class="like">
    <p> {{my_write.like_count}}</p>
    <a href="{% url 'main:post_like_toggle' my_write.id %}">

      {% if my_write in profile.like_post.all %}
      ğŸ’œì·¨ì†Œ
      {% else %}
      ğŸ¤ì¢‹ì•„ìš”
      {% endif %}
    </a>

  </div>

  <div class="comments">
    {% for comment in comments %}
    <span id="username">{{comment.user}}</span>
    <span id="comment_time">| {{comment.updated_at}}</span>
    <div id="comment">{{comment.content}}</div>
    <div id="delete_button"><a href="{% url 'main:delete_comment' my_write.id comment.id%}">ì‚­ì œ</a></div><br>
    <hr>
    <br><br>
    {%endfor%}
  </div>
  <div class="create_comments">
    {% if user.is_authenticated %}
    <form method="POST" action="{% url 'main:create_comment' my_write.id %}">
      {% csrf_token %}
      {{comment_form}}
      <span id="create_button"><button type="submit"><img src="{%static 'images/plane.png'%}"></button></span>
    </form>
    {%endif%}
  </div>

  {% endblock %}